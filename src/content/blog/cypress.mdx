---
title: 'E2e Testing - Cypress'
description: 'Cypressæ˜¯ä¸€å€‹ç¾ä»£çš„å‰ç«¯æ¸¬è©¦æ¡†æ¶ï¼Œå°ˆç‚ºæ¸¬è©¦ Web æ‡‰ç”¨ç¨‹å¼è€Œè¨­è¨ˆã€‚å®ƒæä¾›äº†ç°¡å–®æ˜“ç”¨çš„ APIï¼Œå…è¨±é–‹ç™¼è€…ç·¨å¯«å¿«é€Ÿã€å¯é ä¸”æ˜“æ–¼ç¶­è­·çš„ç«¯å°ç«¯ï¼ˆE2Eï¼‰æ¸¬è©¦ã€‚'
pubDate: '2023/08/18'
heroImage: '../../assets/cypress/cypress-cover.jpeg'
category: 'Testing'
tags: ['Testing', 'CICD']
---

## **Cypress E2E Testing**

[Cypress](https://www.cypress.io/) æ˜¯ä¸€å€‹ç¾ä»£çš„å‰ç«¯æ¸¬è©¦æ¡†æ¶ï¼Œå°ˆç‚ºæ¸¬è©¦ Web æ‡‰ç”¨ç¨‹å¼è€Œè¨­è¨ˆã€‚å®ƒæä¾›äº†ç°¡å–®æ˜“ç”¨çš„ APIï¼Œå…è¨±é–‹ç™¼è€…ç·¨å¯«å¿«é€Ÿã€å¯é ä¸”æ˜“æ–¼ç¶­è­·çš„ç«¯å°ç«¯ï¼ˆE2Eï¼‰æ¸¬è©¦ã€‚Cypress å…·æœ‰å³æ™‚é‡è¼‰ã€è‡ªå‹•ç­‰å¾…ã€äº¤äº’å¼èª¿è©¦ç­‰åŠŸèƒ½ï¼Œä½¿æ¸¬è©¦é–‹ç™¼æ›´åŠ æµæš¢ã€‚å®ƒèƒ½å¤ åœ¨çœŸå¯¦ç€è¦½å™¨ä¸­åŸ·è¡Œæ¸¬è©¦ï¼Œä¸¦æä¾›äº†è±å¯Œçš„æ–·è¨€å’ŒæŸ¥è©¢æ–¹æ³•ï¼Œç”¨æ–¼é©—è­‰ Web æ‡‰ç”¨çš„å„å€‹æ–¹é¢ï¼Œå¾é é¢å…ƒç´ åˆ° API è«‹æ±‚ã€‚Cypress éå¸¸é©åˆè‡ªå‹•åŒ–æ¸¬è©¦ã€æ¸¬è©¦é©…å‹•é–‹ç™¼ï¼ˆTDDï¼‰å’ŒæŒçºŒé›†æˆï¼Œä¸¦èƒ½å¹«åŠ©é–‹ç™¼åœ˜éšŠç¢ºä¿æ‡‰ç”¨ç¨‹å¼çš„ç©©å®šæ€§å’Œå“è³ªã€‚

## **å°å…¥ Cypress å‰è©•ä¼°**

Cypress çš„å°å…¥æœƒå½±éŸ¿ CICD çš„åŸ·è¡Œæ™‚é–“ï¼Œä¸¦ä¸”åœ¨é–‹ç™¼ä¸Šä¹Ÿæœƒç”¢ç”Ÿé¡å¤–çš„æ™‚é–“æˆæœ¬ï¼Œå› æ­¤ï¼Œå°å…¥å‰å¯ä»¥ç”¨ä»¥ä¸‹æ ¹æ“šé€²è¡Œè©•ä¼°ï¼š

- <p style='margin-bottom:12px'>
  	<b>æ¸¬è©¦è¤‡é›œæ€§ï¼š</b>è©•ä¼°å°ˆæ¡ˆçš„æ¸¬è©¦å ´æ™¯å’Œè¤‡é›œæ€§ã€‚Cypress è¼ƒé©åˆ UI
  	äº¤äº’è¤‡é›œã€ç¶²é é é¢å°èˆªå¤šçš„æƒ…å¢ƒï¼Œä½†å°æ–¼è¤‡é›œçš„é UI é‚è¼¯æ¸¬è©¦ï¼Œå¯èƒ½éœ€è¦å…¶ä»–å·¥å…·ã€‚
  </p>

- <p style='margin-bottom:12px'>
  	<b>åŸ·è¡Œæ•ˆç‡ï¼š</b>Cypress
  	çš„çœŸå¯¦ç€è¦½å™¨åŸ·è¡Œå¯èƒ½ç›¸å°è¼ƒæ…¢ã€‚è©•ä¼°æ¸¬è©¦åŸ·è¡Œæ™‚é–“æ˜¯å¦åœ¨å¯æ¥å—ç¯„åœå…§ï¼Œå°¤å…¶æ˜¯ç•¶ä½ çš„æ¸¬è©¦é›†é€æ¼¸å¢åŠ ã€‚
  </p>

- <p style='margin-bottom:12px'>
  	<b>æŒçºŒé›†æˆï¼š</b>Cypress åœ¨ CICD æµç¨‹å…§å¯èƒ½æœƒç™¼ç”Ÿ binary missing çš„å•é¡Œï¼Œéœ€è¦é¡å¤–è¨­å®šè§£æ±ºã€‚
  </p>

- <p style='margin-bottom:12px'>
  	<b>æ¸¬è©¦è¦†è“‹ç‡ï¼š</b>Cypress åœ¨æ¸¬è©¦é–‹ç™¼ä¸­éœ€è¦ DOM
  	çš„é…åˆæ‰èƒ½æŠ“å–å…ƒç´ ï¼Œé€™å€‹å‹•ä½œå¯èƒ½æœƒç”¢ç”Ÿé¡å¤–çš„æ™‚é–“æˆæœ¬ï¼Œå› æ­¤é–‹ç™¼ä¸­å¯ä»¥é‡å°é‡è¦çš„ç•«é¢é€²è¡Œæ¸¬è©¦ï¼Œä¸éœ€è¦æ±‚æ¸¬è©¦è¦†è“‹ç‡ä¸€å®šè¦é”
  	8 æˆã€‚
  </p>

## **ç›®æ¨™**

1. é‡å°æ‰“åŒ…å¾Œæª”æ¡ˆï¼Œä½¿ç”¨ CICD å°ç•«é¢é€²è¡Œè‡ªå‹•åŒ–æ¸¬è©¦
2. ä¸è«–æ¸¬è©¦æˆåŠŸï¼å¤±æ•—ï¼Œçš†æœƒä¿å­˜æ¸¬è©¦å½±ç‰‡
3. æ¸¬è©¦å¤±æ•—æ™‚ï¼Œæœƒé¡å¤–ä¿ç•™å¤±æ•—éƒ¨åˆ†å¿«ç…§åœ–ç‰‡
4. å¿…è¦æ™‚ï¼Œå¯é‡å°é é¢ä¸Šçš„ API é¡å¤–é€²è¡Œæ¸¬è©¦

## **ä¸€ã€ å®‰è£ Cypress**

> ğŸ’¡ æä¾›å…©ç¨®å®‰è£æ–¹å¼ï¼ˆnpmã€pnpmï¼‰

- npm
  ```
   npm install cypress --save-dev
  ```
- pnpm
  ```
   pnpm add cypress -D
  ```
- åœ¨ package.json ä¸­åŠ å…¥æŒ‡ä»¤
  ```
   "cy": "cypress open"
  ```

## **äºŒã€ å®‰è£ Eslint**

> ğŸ’¡ æä¾›å…©ç¨®å®‰è£æ–¹å¼ï¼ˆnpmã€pnpmï¼‰

- npm
  ```
   npm install eslint-plugin-cypress --save-dev
  ```
- pnpm
  ```
    pnpm add eslint-plugin-cypress --save-dev
  ```
- ä¿®æ”¹ eslint.cjs || eslint.json
  ```json
  {
  	"plugins": ["cypress"],
  	"extends": ["plugin:cypress/recommended"]
  }
  ```

## **ä¸‰ã€ é–‹å•Ÿæœ¬åœ°é è¦½ç•«é¢**

- <p style='margin-bottom:12px'>
  	ä½¿ç”¨ <code>pnpm cy</code> é–‹å•Ÿ cypress bashboard æœƒçœ‹åˆ°ä»¥ä¸‹ç•«é¢ï¼Œå¯ä»¥é¸æ“‡{' '}
  	<code>E2E Testing</code>ã€<code>Component Testing</code> >>>
  	<span style='color:red;'>å…ˆä»¥ E2E testing åšæ¸¬è©¦</span>
  </p>
  [![](https://docs.cypress.io/img/guides/core-concepts/cypress-app/the-launchpad.png)](https://docs.cypress.io/img/guides/core-concepts/cypress-app/the-launchpad.png)

- <p style='margin-bottom:12px'>
  	å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡é»æ“Š <code>E2E Testing</code> æœƒå‡ºç¾ <code>config</code> è¨­å®šæª”åˆ—è¡¨ï¼Œå¯ä»¥å…ˆå…¨é¸åŒæ„
  </p>
  [![](https://docs.cypress.io/img/guides/getting-started/opening-the-app/scaffolded-files.png)](https://docs.cypress.io/img/guides/getting-started/opening-the-app/scaffolded-files.png)

- <p style='margin-bottom:12px;margin-top:12px'>
  	æ¥ä¸‹ä¾†éœ€è¦é¸æ“‡é‹è¡Œç€è¦½å™¨ï¼ˆä¾è¨­å‚™ä¸åŒï¼Œèƒ½ç”¨çš„ç€è¦½å™¨ä¹Ÿä¸åŒï¼‰
  </p>
  <sub style='color:ef4444'>
  	âœª æœ¬åœ°æ¸¬è©¦æ™‚ï¼Œå¦‚æœéœ€è¦ <code>Chrome</code> æˆ– <code>Firefox</code> éœ€è¦å…ˆåœ¨æœ¬åœ°å®‰è£ç€è¦½å™¨
  </sub>
  [![](https://docs.cypress.io/img/guides/getting-started/opening-the-app/select-browser.png)](https://docs.cypress.io/img/guides/getting-started/opening-the-app/select-browser.png)

- <p style='margin-bottom:12px'>å»ºç«‹ç¬¬ä¸€å€‹æ¸¬è©¦æª”æ¡ˆ</p>
  [![](https://docs.cypress.io/img/guides/end-to-end-testing/writing-your-first-end-to-end-test/create-new-empty-spec.png)](https://docs.cypress.io/img/guides/end-to-end-testing/writing-your-first-end-to-end-test/create-new-empty-spec.png)

- <p style='margin-bottom:12px;margin-top:12px'>
  	é»æ“Š <code>Create spec</code> å’Œ <code>Okay, run the spec</code>
  </p>
  [![cypresså»ºç«‹æ¸¬è©¦æª”æ¡ˆ1.png](https://bookstack.ltedu.com.tw/uploads/images/gallery/2023-08/scaled-1680-/cypress1.png)](https://bookstack.ltedu.com.tw/uploads/images/gallery/2023-08/cypress1.png)

  [![cypresså»ºç«‹æ¸¬è©¦æª”æ¡ˆ2.png](https://bookstack.ltedu.com.tw/uploads/images/gallery/2023-08/scaled-1680-/cypress2.png)](https://bookstack.ltedu.com.tw/uploads/images/gallery/2023-08/cypress2.png)

  - <p style='margin-bottom:12px;margin-top:12px'>
    	ä¹‹å¾Œæœƒç›´æ¥é–‹å§‹è·‘æ¸¬è©¦ï¼Œå¦‚æœçœ‹åˆ°è·Ÿä¸‹åœ–ä¸€æ¨£çš„ç•«é¢ï¼Œè¡¨ç¤º E2E Testing åˆå§‹åŒ–æˆåŠŸ ğŸ‰
    </p>
    [![cypressæˆåŠŸå»ºç«‹æ¸¬è©¦.png](https://bookstack.ltedu.com.tw/uploads/images/gallery/2023-08/scaled-1680-/cypress.png)](https://bookstack.ltedu.com.tw/uploads/images/gallery/2023-08/cypress.png)

## **å››ã€å‰ç«¯æ’°å¯« `cypress.config.js` è¨­å®šæª”**

`config` ä¸­æœƒæœ‰å…©å¤§ç‰©ä»¶ï¼Œåˆ†åˆ¥æ˜¯ `e2e` åŠ `component`ã€‚

`e2e` æ˜¯ E2E Testing çš„è¨­å®šæª”ï¼Œ`component` æ˜¯ Component Testing çš„è¨­å®šæª”ï¼Œå…©é‚Šçš„è¨­å®šä¸æœƒäº’ç›¸æ±¡æŸ“ï¼Œé™¤éæŸè¨­å®šæ˜¯å¯«åœ¨å…¨åŸŸçš„é™¤å¤–ã€‚

ç›®å‰æœ‰ä½¿ç”¨åˆ° `e2e` çš„è¨­å®šå¦‚ä¸‹ï¼š

- `browser`ï¼šè¨­å®šæ¸¬è©¦ç’°å¢ƒé è¨­é–‹å•Ÿçš„ç€è¦½å™¨
- `baseUrl`ï¼šè¨­å®š `visit` ç¶²å€ï¼Œå¯ä»¥æ­é… `cy.visit('/')` ä½¿ç”¨
- `proxyUrl`ï¼šè¨­å®š `proxy` ç¶²å€ï¼Œå¯ä»¥æ­é… `cy.request()` ä½¿ç”¨
- `viewportWidth`ï¼šè¨­å®šé è¨­ç€è¦½å™¨å¯¬åº¦
- `viewportHeight`ï¼šè¨­å®šé è¨­ç€è¦½å™¨é«˜åº¦
- `videoCompression`ï¼šè¨­å®šå½±ç‰‡å£“ç¸®ç‡ï¼Œå¯è¨­å®š 0ï¼ˆç•«è³ªæœ€å·®ï¼‰ ~ 100ï¼ˆç•«è³ªæœ€å¥½ï¼‰
- `chromeWebSecurity`ï¼šè¨­å®šæ˜¯å¦è¦é—œé–‰ç€è¦½å™¨å®‰å…¨æ€§ï¼Œå¯ä»¥é¿å… CORS å•é¡Œ
- `specPattern`ï¼šè¨­å®šæ¸¬è©¦æª”æ¡ˆè·¯å¾‘

- <p style='margin:12px 0'>
  	<b>ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š</b>
  </p>

  ```javascript
  module.exports = defineConfig({
  	e2e: {
  		setupNodeEvents(on, config) {
  			// implement node event listeners here
  		},
  		browser: 'chrome',
  		baseUrl: 'http://localhost:5177',
  		proxyUrl: 'http://localhost:5177',
  		viewportHeight: 1080,
  		viewportWidth: 1920,
  		videoCompression: 32,
  		chromeWebSecurity: false,
  		specPattern: 'cypress/e2e/**/*.{cy,spec}.{js,jsx,ts,tsx}'
  	}
  })
  ```

## **äº”ã€å¸¸ç”¨æŒ‡ä»¤èªªæ˜**

<details>
  <summary>describeï¼šæ¸¬è©¦æ¨¡ç‰ˆ</summary>

- <p style='margin:12px 0'>ç¬¬ä¸€å€‹åƒæ•¸ç‚ºæ¨¡ç‰ˆåç¨±ï¼ˆå¯è‡ªè¨‚ï¼‰ï¼Œä¹Ÿå¯ä»¥æƒ³åƒæˆæ¸¬è©¦ç¾¤çµ„</p>

```javascript
describe('template spec', callback)
```

</details>

<details>
  <summary>itï¼šè¨­å®šæ¸¬è©¦ç›®æ¨™</summary>

- <p style='margin:12px 0'>ç¬¬ä¸€å€‹åƒæ•¸ç‚ºæ¸¬è©¦ç›®æ¨™åç¨±ï¼ˆå¯è‡ªè¨‚ï¼‰ï¼Œå¯ä»¥æƒ³åƒæˆä»»å‹™åç¨±</p>

```javascript
describe('template spec', () => {
	it('passes', callback)
})
```

</details>

<details>
  <summary>visitï¼šè¨ªå• URL</summary>

- <p style='margin:12px 0'>ä»»å‹™å…§å®¹æ˜¯æ¸¬è©¦èƒ½å¦é€£æ¥åˆ° Google</p>

```javascript
describe('template spec', () => {
	it('passes', () => {
		cy.visit('https://google.com')
	})
})
```

</details>

<details>
  <summary>expectï¼šæ–·è¨€çš„ä¸€ç¨®ï¼Œç”¨æ–¼é©—è­‰çµæœæ˜¯ã€ æˆåŠŸ ã€ã€ã€ å¤±æ•— ã€</summary>

- <p style='margin:12px 0'>
  	é©—è­‰ <code>true === true</code> æ˜¯å¦æˆç«‹
  </p>

```javascript
describe('My First Test', () => {
	it('Does not do much!', () => {
		expect(true).to.equal(true)
	})
})
```

</details>

<details>
  <summary>shouldï¼šæ–·è¨€çš„ä¸€ç¨®ï¼Œç”¨æ–¼åˆ¤æ–·æ¢ä»¶æ˜¯å¦æˆç«‹</summary>

> should é€šå¸¸æœƒæ­é…ã€ æ–·è¨€ä¿®é£¾ç¬¦ ã€ä½¿ç”¨ï¼Œä¿®é£¾ç¬¦ç¨®é¡å¾ˆå¤šï¼Œå»ºè­°ç›´æ¥ GPT

- `match`ï¼šé©—è­‰æ˜¯å¦ç¬¦åˆè¡¨é”å¼è¦å‰‡

```javascript
cy.get('#student-search')
	.invoke('val')
	.should('match', /^\S+@\S+\.\S+$/)
```

- `be`ï¼šé©—è­‰æ˜¯å¦ç‚º disable ç‹€æ…‹

```javascript
cy.contains('button', 'é€å‡ºæŸ¥è©¢').should('be.disabled')
```

</details>

<details>
  <summary>invokeï¼šç²å– DOM</summary>

> å¸¸è¦‹ä½¿ç”¨æƒ…æ™¯ï¼šå–å€¼ã€å–å±¬æ€§ã€é©—è­‰ DOM å…§å®¹

- `æƒ…æ™¯1ï¼šå–å€¼` â‡’ æª¢æŸ¥ input çš„å€¼æ˜¯å¦ç‚ºä¿¡ç®±æ ¼å¼

```javascript
cy.get('#student-search').type(correctMail)
cy.get('#student-search')
	.invoke('val')
	.should('match', /^\S+@\S+\.\S+$/)
```

- `æƒ…æ™¯2ï¼šå–å±¬æ€§` â‡’ log ç•¶å‰ input çš„å€¼

```javascript
cy.get('#student-search').type(correctMail)
cy.get("[test-id='input-text']")
	.invoke('val')
	.then((val) => {
		cy.log('val', val)
	})
```

- `æƒ…æ™¯3ï¼šé©—è­‰ DOM å…§å®¹` â‡’ æª¢æŸ¥ DOM å…§æœ‰æŒ‡å®šæ¨£å¼

```javascript
cy.get('#student-search').type(correctMail)
cy.get("[test-id='input-text']").invoke('attr', 'class').should('contain', 'text-lg')
```

</details>

<details>
  <summary>containsï¼šé¸æ“‡ç‰¹å®šå…ƒç´ æˆ–æ–‡å­—</summary>

- <p style='margin:12px 0'>é¸æ“‡åŒ…å«ã€ é€å‡ºæŸ¥è©¢ ã€çš„ button</p>

```javascript
cy.contains('button', 'é€å‡ºæŸ¥è©¢').click()
```

- <p style='margin:12px 0'>ç¢ºå®šã€ é€å‡ºæŸ¥è©¢ ã€æ˜¯å¦ç‚º disable</p>

```javascript
cy.get('#student-search').type('error.mail')
cy.contains('button', 'é€å‡ºæŸ¥è©¢').should('be.disabled')
```

</details>

<details>
  <summary>logï¼šæ–¼æ¸¬è©¦æ™‚é¡¯ç¤ºç‰¹å®šå…§å®¹</summary>

- <p style='margin:12px 0'>å–®ç´”é¡¯ç¤º log</p>

```javascript
cy.log('æ¸¬è©¦æˆåŠŸ')
```

- <p style='margin:12px 0'>
  	é¡¯ç¤ºç‰¹å®šå…§å®¹ï¼Œéœ€ä½¿ç”¨ <code>.then</code> é€£æ¥
  </p>

```javascript
cy.get('#student-search')
	.invoke('val')
	.then((val) => {
		cy.log('input=>', val)
	})
```

</details>
